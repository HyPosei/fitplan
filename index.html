<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="version" content="2.1.0">
  <meta name="theme-color" content="#ec4899">
  <meta name="description" content="Ki≈üisel spor programƒ±n - Aƒüƒ±rlƒ±k takibi, ilerleme ve daha fazlasƒ±">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FitPlan">
  <link rel="apple-touch-icon" href="./icon-512.png">
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
  <link rel="manifest" href="./manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <title>FitPlan - Senin Programƒ±n</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      /* Premium Dark Palette */
      --bg-primary: #0f1115;
      --bg-surface: #181b21;
      --bg-surface-hover: #22262e;
      --bg-glass: rgba(24, 27, 33, 0.7);

      --text-primary: #ffffff;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;

      --accent: #ec4899;
      --accent-gradient: linear-gradient(135deg, #ec4899 0%, #f97316 100%);
      --accent-glow: rgba(236, 72, 153, 0.3);

      --success: #10b981;
      --danger: #ef4444;

      --border: #2d313a;
      --border-light: #374151;

      /* Spacing & Radius */
      --radius-sm: 8px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-full: 9999px;

      --shadow-soft: 0 8px 30px rgba(0, 0, 0, 0.3);
      --shadow-surface: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }

    html,
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px;
      padding-bottom: 120px;
    }

    /* --- Typography --- */
    h1,
    h2,
    h3 {
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    h1 {
      font-size: 24px;
    }

    h2 {
      font-size: 20px;
    }

    h3 {
      font-size: 16px;
    }

    p {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .info-text {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    /* --- Header (Welcome) --- */
    .header {
      text-align: center;
      padding: 40px 0 48px;
    }

    .header .logo {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 4px;
      color: var(--accent);
      font-weight: 700;
      margin-bottom: 16px;
    }

    .header h1 {
      font-size: 32px;
      color: var(--text-primary);
    }

    .header p {
      margin-top: 8px;
    }

    /* --- Components: Cards --- */
    .card {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-surface);
      /* Glassmorphism hint */
      backdrop-filter: blur(10px);
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .card:active {
      transform: scale(0.995);
    }

    .card-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    /* --- Components: Buttons --- */
    button {
      font-family: inherit;
      border: none;
      cursor: pointer;
      user-select: none;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border-radius: var(--radius-md);
      font-size: 15px;
      font-weight: 600;
      background: var(--accent-gradient);
      color: white;
      box-shadow: 0 4px 15px var(--accent-glow);
      transition: all 0.2s ease;
    }

    .btn:active {
      transform: scale(0.98);
      opacity: 0.9;
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-primary);
      box-shadow: none;
    }

    .btn-reset {
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      margin-top: 20px;
      text-decoration: underline;
      width: 100%;
      text-align: center;
      padding: 10px;
    }

    /* --- App Bar (Hidden here, defined below) --- */
    .app-bar {
      display: none;
    }


    /* Fixed Bottom Button */
    .fixed-bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      background: linear-gradient(to top, var(--bg-primary) 80%, transparent);
      z-index: 100;
    }

    .fixed-bottom .btn-primary {
      display: block;
      width: 100%;
      max-width: 440px;
      margin: 0 auto;
    }

    .btn-primary {
      width: 100%;
      padding: 18px;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 700;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 14px var(--accent-glow);
    }

    .btn-primary:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px var(--accent-glow);
    }

    .btn-primary:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* Program Section */
    #program-section {
      display: none;
      padding-top: 20px;
    }

    .program-header {
      margin-bottom: 24px;
    }

    .program-header h2 {
      font-size: 28px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .program-summary {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .summary-badge {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    /* Day Accordion */
    .day-section {
      margin-bottom: 12px;
    }

    .day-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .day-header.active {
      background: var(--accent);
      border-color: var(--accent);
      border-radius: 12px 12px 0 0;
    }

    .day-header h3 {
      font-size: 16px;
      font-weight: 700;
    }

    .day-header .count {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .day-header.active .count {
      color: rgba(255, 255, 255, 0.8);
    }

    .day-header .arrow {
      font-size: 12px;
      transition: transform 0.2s;
    }

    .day-header.active .arrow {
      transform: rotate(180deg);
    }

    .day-content {
      display: none;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 12px 12px;
      padding: 16px;
      background: var(--bg-primary);
    }

    .day-content.active {
      display: block;
    }

    /* Exercise Card */
    .exercise-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .exercise-card.completed {
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
      border-color: #fbcfe8;
    }

    .exercise-card:last-child {
      margin-bottom: 0;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .exercise-name {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .exercise-target {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .exercise-sets {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      white-space: nowrap;
    }

    .exercise-meta {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .exercise-meta span {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Video Container */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: var(--bg-input);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .video-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg-input);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .video-placeholder:hover {
      background: var(--border);
    }

    .video-placeholder .play-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }

    .video-placeholder .play-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
      margin-left: 3px;
    }

    .video-placeholder .play-text {
      font-size: 14px;
      font-weight: 500;
    }

    /* Buttons Row */
    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }

    .btn-secondary {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 600;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: var(--bg-input);
      color: var(--text-primary);
    }

    .btn-youtube {
      color: #ef4444;
      border-color: rgba(239, 68, 68, 0.3);
    }

    .btn-youtube:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    /* Checkbox */
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      background: var(--bg-input);
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 12px;
    }

    .checkbox-row input {
      width: 20px;
      height: 20px;
      accent-color: var(--success);
    }

    .checkbox-row label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
    }

    /* Tip */
    .exercise-tip {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px 14px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 8px;
      font-size: 13px;
      color: var(--accent);
    }

    .exercise-tip svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* Motivational Footer */
    .motivation-box {
      text-align: center;
      padding: 40px 24px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-top: 24px;
    }

    .motivation-box h3 {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .motivation-box p {
      font-size: 15px;
      color: var(--text-secondary);
    }

    /* Reset Button */
    .btn-reset {
      display: block;
      width: 100%;
      padding: 16px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-muted);
      background: transparent;
      border: none;
      cursor: pointer;
      margin: 24px 0 40px;
    }

    .btn-reset:hover {
      color: var(--text-secondary);
    }

    /* Weight Input */
    .weight-input {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .weight-input label {
      font-size: 13px;
      color: var(--text-secondary);
      min-width: 60px;
    }

    .weight-input input {
      flex: 1;
      padding: 10px;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 600;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      text-align: center;
    }

    .weight-input input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .weight-input .unit-label {
      font-size: 13px;
      color: var(--text-muted);
      min-width: 25px;
    }

    /* Progress Bar */
    .progress-container {
      margin-bottom: 12px;
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-input);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
      text-align: center;
    }

    /* --- Timer Float --- */
    .timer-float {
      position: fixed;
      bottom: 100px;
      right: 20px;
      background: rgba(15, 17, 21, 0.9);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      padding: 16px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      z-index: 80;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      transform: translateY(200px);
      transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    }

    .timer-float.active {
      transform: translateY(0);
      display: flex;
    }

    .timer-display {
      font-family: monospace;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: 2px;
    }

    .timer-controls {
      display: flex;
      gap: 8px;
    }

    .timer-btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg-surface-hover);
      color: var(--text-secondary);
    }

    .timer-btn.primary {
      background: var(--accent);
      color: white;
    }

    /* --- History & Weight Views --- */
    .history-week-group {
      margin-bottom: 24px;
    }

    .history-week-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted);
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 8px;
    }

    .history-date {
      font-weight: 600;
      color: var(--text-primary);
    }

    .history-info {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* --- Projects View --- */
    .project-card {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
    }

    .project-card.active-project {
      border: 1px solid var(--accent);
      background: radial-gradient(circle at top right, rgba(236, 72, 153, 0.1), transparent);
    }

    .project-name {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .project-meta {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .project-active-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Fab Add Button */
    .fab-add {
      position: fixed;
      bottom: 32px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent-gradient);
      box-shadow: 0 4px 20px var(--accent-glow);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: white;
      z-index: 90;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    }

    .fab-add:active {
      transform: scale(0.9);
    }

    /* Modal */
    .modal-backdrop {
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      width: 90%;
      max-width: 400px;
      background: #181b21;
      border: 1px solid var(--border);
      padding: 32px;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      color: white;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      background: #22262e;
      border: 1px solid var(--border);
      padding: 14px;
      border-radius: 12px;
      color: white;
      outline: none;
      transition: border 0.2s;
    }

    .form-input:focus {
      border-color: var(--accent);
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .modal-actions .btn {
      flex: 1;
    }

    /* Summary Badge */
    .summary-badge {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      font-size: 12px;
      font-weight: 600;
      border-radius: 20px;
      margin-bottom: 16px;
      margin-right: 8px;
    }

    /* Today Button */
    .today-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, var(--accent), var(--accent-hover));
      border: none;
      border-radius: 16px;
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 24px;
      box-shadow: 0 4px 14px var(--accent-glow);
    }

    .today-btn:active {
      transform: scale(0.98);
    }

    .today-btn .subtitle {
      font-size: 13px;
      font-weight: 400;
      opacity: 0.9;
      margin-top: 4px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    /* Number input */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    /* Subtle Info */
    .info-text {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }
  </style>
</head>

<body>
  <!-- Drawer Backdrop -->
  <div class="drawer-backdrop" id="drawer-backdrop" onclick="closeDrawer()"></div>

  <!-- Left Drawer -->
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <h2>FitPlan</h2>
      <p id="drawer-subtitle">Bug√ºn: Dinlenme</p>
    </div>

    <div class="drawer-menu">
      <div class="drawer-menu-item active" onclick="navigateTo('today')">
        <span class="drawer-menu-icon">üè†</span>
        <span class="drawer-menu-label">Bug√ºn</span>
      </div>
      <div class="drawer-menu-item" onclick="navigateTo('history')">
        <span class="drawer-menu-icon">üìä</span>
        <span class="drawer-menu-label">Ge√ßmi≈ü</span>
      </div>
      <div class="drawer-menu-item" onclick="navigateTo('weights')">
        <span class="drawer-menu-icon">üí™</span>
        <span class="drawer-menu-label">Aƒüƒ±rlƒ±klar</span>
      </div>
      <div class="drawer-menu-item" onclick="navigateTo('stats')">
        <span class="drawer-menu-icon">üìà</span>
        <span class="drawer-menu-label">ƒ∞statistikler</span>
      </div>
    </div>

    <div class="drawer-section-title">ƒ∞steƒüe Baƒülƒ±</div>
    <div class="drawer-menu">
      <div class="drawer-menu-item" onclick="navigateTo('projects')">
        <span class="drawer-menu-icon">üìÅ</span>
        <span class="drawer-menu-label">Projelerim</span>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Compact App Bar (Hidden by default) -->
    <div class="app-bar" id="app-bar" style="display: none;">
      <div class="app-bar-left">
        <button class="hamburger-btn" onclick="openDrawer()">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div>
          <div class="app-bar-title">FitPlan</div>
        </div>
      </div>
      <div class="app-bar-right">
        <!-- Progress indicator could go here -->
      </div>
    </div>

    <!-- Header (Welcome Screen) -->
    <div class="header" id="welcome-header">
      <div class="logo">FitPlan</div>
      <h1>Spor Programƒ±n</h1>
      <p>Sana √∂zel, basit ve etkili</p>
    </div>

    <!-- Questions Section -->
    <div id="questions-section">
      <!-- Height -->
      <div class="card">
        <div class="card-label">1 / 5</div>
        <div class="card-title">Boyun ka√ß cm?</div>
        <div class="input-group">
          <input type="number" id="height" placeholder="170" inputmode="numeric">
          <span class="unit">cm</span>
        </div>
      </div>

      <!-- Weight -->
      <div class="card">
        <div class="card-label">2 / 5</div>
        <div class="card-title">Kilon ka√ß kg?</div>
        <div class="input-group">
          <input type="number" id="weight" placeholder="70" inputmode="numeric">
          <span class="unit">kg</span>
        </div>
      </div>

      <!-- Age -->
      <div class="card">
        <div class="card-label">3 / 5</div>
        <div class="card-title">Ka√ß ya≈üƒ±ndasƒ±n?</div>
        <div class="input-group">
          <input type="number" id="age" placeholder="25" inputmode="numeric">
          <span class="unit">ya≈ü</span>
        </div>
      </div>

      <!-- Goals -->
      <div class="card">
        <div class="card-label">4 / 5</div>
        <div class="card-title">Ne istiyorsun?</div>
        <p class="info-text">Birden fazla se√ßebilirsin</p>
        /* --- Goal Grid --- */
        .goal-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        }

        .goal-btn {
        background: var(--bg-surface-hover);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
        /* Fix for legacy styles overriding */
        text-align: center;
        cursor: pointer;
        }

        .goal-btn .icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255,255,255,0.05);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0.7;
        /* Remove potential gradient overrides */
        margin: 0 auto;
        }

        .goal-btn .icon svg {
        stroke: var(--text-primary);
        width: 20px;
        height: 20px;
        }

        /* Fix for svg clicks */
        .goal-btn * {
        pointer-events: none;
        }

        .goal-btn .label {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        line-height: 1.3;
        }

        .goal-btn .check {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        background: var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transform: scale(0.5);
        transition: all 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .goal-btn .check svg {
        width: 14px;
        height: 14px;
        stroke: white;
        stroke-width: 3;
        }

        .goal-btn.selected {
        background: rgba(236, 72, 153, 0.08); /* Transparent accent */
        border-color: var(--accent);
        }

        .goal-btn.selected .icon {
        background: var(--accent);
        opacity: 1;
        }

        .goal-btn.selected .icon svg {
        stroke: white;
        }

        .goal-btn.selected .label {
        color: var(--text-primary);
        }

        .goal-btn.selected .check {
        opacity: 1;
        transform: scale(1);
        }

        /* --- Day Grid --- */
        .day-grid {
        display: flex;
        gap: 12px;
        }

        .day-btn {
        flex: 1;
        height: 50px;
        border-radius: var(--radius-sm);
        background: var(--bg-surface-hover);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        font-size: 18px;
        font-weight: 600;
        transition: all 0.2s;
        /* Fix for legacy overrides */
        padding: 0;
        cursor: pointer;
        }

        .day-btn:active {
        transform: scale(0.96);
        }

        .day-btn.selected {
        background: var(--text-primary);
        color: var(--bg-primary);
        border-color: var(--text-primary);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
        }

        /* --- Hamburger Button Fix --- */
        .hamburger-btn {
        width: 44px;
        height: 44px;
        border: none;
        background: transparent;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 5px;
        padding: 0;
        border-radius: 8px;
        }

        .hamburger-btn:active {
        background: rgba(255,255,255,0.05);
        }

        .hamburger-btn span {
        width: 22px;
        height: 2px;
        background: var(--text-primary);
        border-radius: 2px;
        transition: all 0.3s;
        }


        <!-- Program Section -->
        <div id="program-section">
          <div class="program-header">
            <h2>Senin Programƒ±n</h2>
            <div class="program-summary" id="program-summary"></div>
          </div>
          <div id="days-container"></div>

          <div class="motivation-box">
            <h3>Hazƒ±rsƒ±n!</h3>
            <p>Bug√ºn harika i≈ü √ßƒ±karacaksƒ±n. Ba≈üarƒ±lar!</p>
          </div>

          <button class="btn-reset" onclick="resetApp()">Ba≈ütan Ba≈üla</button>
        </div>
      </div>

      <!-- Fixed Bottom Button -->
      <div class="fixed-bottom" id="fixed-bottom">
        <button class="btn-primary" id="show-program-btn" onclick="showProgram()">
          Programƒ±mƒ± G√∂ster
        </button>
      </div>

      <!-- Floating Timer -->
      <div class="timer-float" id="timer-widget">
        <div class="timer-display" id="timer-display">00:00</div>
        <div class="timer-controls">
          <button class="timer-btn primary" id="timer-start" onclick="startTimer()">Ba≈ülat</button>
          <button class="timer-btn" id="timer-stop" onclick="stopTimer()">Durdur</button>
          <button class="timer-btn" id="timer-reset" onclick="resetTimer()">Sƒ±fƒ±rla</button>
        </div>
      </div>

      <!-- History Section -->
      <!-- History Section -->
      <div id="history-section" style="display: none;" class="container">
        <div class="card">
          <div class="card-title">Antrenman Ge√ßmi≈üi</div>
          <div id="history-container">
            <!-- History items will be rendered here -->
            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Hen√ºz ge√ßmi≈ü kaydƒ± yok.</p>
          </div>
        </div>
      </div>

      <!-- Weights Section -->
      <div id="weights-section" style="display: none;" class="container">
        <div class="card">
          <div class="card-title">Aƒüƒ±rlƒ±k Ge√ßmi≈üi</div>
          <div id="weights-container">
            <!-- Weight items will be rendered here -->
            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Hen√ºz aƒüƒ±rlƒ±k kaydƒ± yok.</p>
          </div>
        </div>
      </div>

      <!-- Projects Section -->
      <div id="projects-section" style="display: none; padding-top: 60px; padding-bottom: 100px;">
        <div class="card-title">Projelerim</div>
        <div id="projects-container" style="padding: 0 20px;">
          <!-- Projects rendered here -->
        </div>
        <div class="fab-add" onclick="openProjectModal()">+</div>
      </div>

      <!-- CREATE PROJECT MODAL -->
      <div id="project-modal" class="modal-backdrop">
        <div class="modal-content">
          <div class="modal-title">Yeni Proje Olu≈ütur</div>
          <div class="form-group">
            <label>Proje Adƒ±</label>
            <input type="text" id="project-name" class="form-input" placeholder="√ñrn: Yaz Hazƒ±rlƒ±k">
          </div>
          <div class="form-group">
            <label>A√ßƒ±klama / Not</label>
            <input type="text" id="project-note" class="form-input" placeholder="√ñrn: Bulk d√∂nemi">
          </div>
          <p style="font-size:13px; color:var(--text-secondary); margin-bottom:20px;">
            ‚ö†Ô∏è ≈ûu anki program ayarlarƒ±n (se√ßili hedefler, g√ºn sayƒ±sƒ±) bu projeye kaydedilecek.
          </p>
          <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeProjectModal()">ƒ∞ptal</button>
            <button class="btn" onclick="saveProject()">Kaydet</button>
          </div>
        </div>
      </div>

      <script>
        // ============================================
        // EXERCISE DATA
        // ============================================
        const exercises = [
          // G√ñƒû√úS
          { id: "bench_press", name: "Barbell Bench Press", goals: ["kas", "sikilasma", "guc"], target: "G√∂ƒü√ºs, √ñn Omuz", region: "chest", type: "free_weight", sets: 4, reps: "8-12", rest: 90, videoId: "cHwutxa3XLY", howToLink: "https://www.youtube.com/watch?v=cHwutxa3XLY", tip: "Barƒ± g√∂ƒü√ºs hizasƒ±ndan yukarƒ± it" },
          { id: "incline_press", name: "Incline Bench Press", goals: ["kas", "guc"], target: "√úst G√∂ƒü√ºs, √ñn Omuz", region: "chest", type: "free_weight", sets: 4, reps: "8-12", rest: 90, videoId: "3upIH4tyAQE", howToLink: "https://www.youtube.com/watch?v=3upIH4tyAQE", tip: "√úst g√∂ƒü√ºs√º hedefle" },
          { id: "dumbbell_fly", name: "Dumbbell Fly", goals: ["sikilasma", "kas"], target: "G√∂ƒü√ºs ƒ∞zolasyon", region: "chest", type: "free_weight", sets: 3, reps: "12-15", rest: 60, videoId: "Gth_I4CEAB0", howToLink: "https://www.youtube.com/watch?v=Gth_I4CEAB0", tip: "G√∂ƒüs√º esnet ve sƒ±kƒ±≈ütƒ±r" },
          { id: "cable_crossover", name: "Cable Crossover", goals: ["sikilasma"], target: "G√∂ƒü√ºs ƒ∞√ß", region: "chest", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "2E1x1MvR9qo", howToLink: "https://www.youtube.com/watch?v=2E1x1MvR9qo", tip: "S√ºrekli gerginlik altƒ±nda tut" },
          { id: "chest_press_machine", name: "Chest Press Makinesi", goals: ["kas", "sikilasma"], target: "G√∂ƒü√ºs", region: "chest", type: "machine", sets: 3, reps: "10-12", rest: 60, videoId: "2wFMkurVmrQ", howToLink: "https://www.youtube.com/watch?v=2wFMkurVmrQ", tip: "G√ºvenli ve kontroll√º hareket" },
          { id: "pushup", name: "Push-Up", goals: ["kilo_verme", "sikilasma", "kas", "kol"], target: "G√∂ƒü√ºs & Kol", region: "chest", type: "body_weight", sets: 3, reps: "15-20", rest: 60, videoId: "RyzxRrBHn7k", howToLink: "https://www.youtube.com/watch?v=RyzxRrBHn7k", tip: "V√ºcudun d√ºz bir √ßizgi olmalƒ±" },
          { id: "dips", name: "Dips", goals: ["kas", "sikilasma", "kol"], target: "Alt G√∂ƒü√ºs & Triceps", region: "chest", type: "body_weight", sets: 3, reps: "8-12", rest: 90, videoId: "H9G1wL4yujU", howToLink: "https://www.youtube.com/watch?v=H9G1wL4yujU", tip: "Paralel barlarda kontroll√º in-√ßƒ±k" },
          { id: "decline_bench", name: "Decline Bench Press", goals: ["kas"], target: "Alt G√∂ƒü√ºs", region: "chest", type: "free_weight", sets: 3, reps: "8-12", rest: 90, videoId: "0xRvl4Qv3ZY", howToLink: "https://www.youtube.com/watch?v=0xRvl4Qv3ZY", tip: "Alt g√∂ƒü√ºs√º doldurmak i√ßin" },
          { id: "machine_pec_deck", name: "Machine Pec Deck", goals: ["sikilasma"], target: "G√∂ƒü√ºs ƒ∞zolasyon", region: "chest", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "eGjt4lk6g34", howToLink: "https://www.youtube.com/watch?v=eGjt4lk6g34", tip: "ƒ∞zole sƒ±kƒ±≈ütƒ±rma hareketi" },
          { id: "incline_dumbbell_fly", name: "Incline Dumbbell Fly", goals: ["sikilasma"], target: "√úst G√∂ƒü√ºs", region: "chest", type: "free_weight", sets: 3, reps: "12-15", rest: 60, videoId: "ajdFwa-qM98", howToLink: "https://www.youtube.com/watch?v=ajdFwa-qM98", tip: "√úst g√∂ƒüs√º ≈üekillendir" },
          { id: "smith_bench", name: "Smith Machine Bench Press", goals: ["kas"], target: "G√∂ƒü√ºs", region: "chest", type: "machine", sets: 4, reps: "8-12", rest: 90, videoId: "5p2J6oKJ2iw", howToLink: "https://www.youtube.com/watch?v=5p2J6oKJ2iw", tip: "G√ºvenli press" },

          // SIRT
          { id: "pullup", name: "Pull-Up", goals: ["kas", "kilo_verme", "sikilasma"], target: "Sƒ±rt & Biceps", region: "back", type: "body_weight", sets: 3, reps: "6-10", rest: 90, videoId: "eu3pSe55-Qg", howToLink: "https://www.youtube.com/watch?v=eu3pSe55-Qg", tip: "√úst v√ºcut √ßeki≈ü g√ºc√º" },
          { id: "lat_pulldown", name: "Lat Pulldown", goals: ["kas", "sikilasma"], target: "Kanat Kaslarƒ±", region: "back", type: "machine", sets: 4, reps: "10-12", rest: 60, videoId: "hEt8rkd7-Gk", howToLink: "https://www.youtube.com/watch?v=hEt8rkd7-Gk", tip: "Barfiks alternatifi" },
          { id: "barbell_row", name: "Barbell Row", goals: ["kas", "sikilasma", "guc"], target: "Orta Sƒ±rt", region: "back", type: "free_weight", sets: 4, reps: "8-12", rest: 90, videoId: "-lGIRM-tbDk", howToLink: "https://www.youtube.com/watch?v=-lGIRM-tbDk", tip: "Sƒ±rt kalƒ±nlƒ±ƒüƒ± ve g√º√ß" },
          { id: "seated_cable_row", name: "Seated Cable Row", goals: ["sikilasma", "kas"], target: "Orta Sƒ±rt", region: "back", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "DOlLdf20xf0", howToLink: "https://www.youtube.com/watch?v=DOlLdf20xf0", tip: "Oturarak √ßeki≈ü hareketi" },
          { id: "hyperextension", name: "Hyperextension", goals: ["sikilasma", "karin", "guc"], target: "Alt Sƒ±rt & Bel", region: "back", type: "body_weight", sets: 3, reps: "12-15", rest: 45, videoId: "cfdi2mTOv6Q", howToLink: "https://www.youtube.com/watch?v=cfdi2mTOv6Q", tip: "Bel kaslarƒ±nƒ± g√º√ßlendir" },
          { id: "assisted_pullup", name: "Assisted Pull-Up", goals: ["kas", "sikilasma"], target: "Sƒ±rt", region: "back", type: "machine", sets: 3, reps: "8-12", rest: 90, videoId: "Z2n58m2i4jg", howToLink: "https://www.youtube.com/watch?v=Z2n58m2i4jg", tip: "Makine destekli barfiks" },
          { id: "single_arm_row", name: "Single Arm Dumbbell Row", goals: ["kas", "sikilasma"], target: "Kanat", region: "back", type: "free_weight", sets: 3, reps: "10-12", rest: 60, videoId: "pYcpY20QaE8", howToLink: "https://www.youtube.com/watch?v=pYcpY20QaE8", tip: "Tek taraflƒ± g√º√ß ve denge" },
          { id: "wide_grip_lat", name: "Wide Grip Lat Pulldown", goals: ["sikilasma"], target: "Kanat", region: "back", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "lueEJGjTuPQ", howToLink: "https://www.youtube.com/watch?v=lueEJGjTuPQ", tip: "Sƒ±rt geni≈üliƒüi i√ßin" },
          { id: "reverse_grip_lat", name: "Reverse Grip Lat Pulldown", goals: ["kas"], target: "Alt Kanat", region: "back", type: "machine", sets: 3, reps: "10-12", rest: 60, videoId: "7oQX5nVJjIg", howToLink: "https://www.youtube.com/watch?v=7oQX5nVJjIg", tip: "Alt kanat ve biceps" },

          // OMUZ
          { id: "overhead_press", name: "Overhead Press", goals: ["kas", "kol", "guc"], target: "√ñn & Orta Omuz", region: "shoulder", type: "free_weight", sets: 4, reps: "8-12", rest: 90, videoId: "13YElyAtd84", howToLink: "https://www.youtube.com/watch?v=13YElyAtd84", tip: "Temel dikey iti≈ü" },
          { id: "lateral_raise", name: "Lateral Raise", goals: ["sikilasma", "kol"], target: "Orta Omuz", region: "shoulder", type: "free_weight", sets: 3, reps: "12-15", rest: 45, videoId: "weDBwj9Kuaw", howToLink: "https://www.youtube.com/watch?v=weDBwj9Kuaw", tip: "Omuz geni≈üliƒüi kazandƒ±rƒ±r" },
          { id: "face_pull", name: "Face Pull", goals: ["sikilasma"], target: "Arka Omuz", region: "shoulder", type: "machine", sets: 3, reps: "15-20", rest: 45, videoId: "vuDO21_zqbQ", howToLink: "https://www.youtube.com/watch?v=vuDO21_zqbQ", tip: "Post√ºr d√ºzeltici" },
          { id: "arnold_press", name: "Arnold Press", goals: ["kas"], target: "√ñn Omuz", region: "shoulder", type: "free_weight", sets: 3, reps: "10-12", rest: 90, videoId: "6Z15_WdXmVw", howToLink: "https://www.youtube.com/watch?v=6Z15_WdXmVw", tip: "Omuz hacmi ve ≈üekli" },
          { id: "cable_lateral", name: "Cable Lateral Raise", goals: ["sikilasma"], target: "Orta Omuz", region: "shoulder", type: "machine", sets: 3, reps: "15-20", rest: 45, videoId: "0Z6zKqH2G9g", howToLink: "https://www.youtube.com/watch?v=0Z6zKqH2G9g", tip: "S√ºrekli gerginlik" },
          { id: "rear_delt_raise", name: "Rear Delt Dumbbell Raise", goals: ["sikilasma"], target: "Arka Omuz", region: "shoulder", type: "free_weight", sets: 3, reps: "15-20", rest: 45, videoId: "eaXq7UjE5A0", howToLink: "https://www.youtube.com/watch?v=eaXq7UjE5A0", tip: "Omuz dengesi" },

          // KOL
          { id: "barbell_curl", name: "Barbell Curl", goals: ["kas", "kol"], target: "Biceps", region: "arm", type: "free_weight", sets: 3, reps: "10-12", rest: 60, videoId: "M3qQOkiJfoU", howToLink: "https://www.youtube.com/watch?v=M3qQOkiJfoU", tip: "Temel biceps hacmi" },
          { id: "hammer_curl", name: "Hammer Curl", goals: ["kas", "kol"], target: "Biceps & √ñn Kol", region: "arm", type: "free_weight", sets: 3, reps: "10-12", rest: 60, videoId: "X98pBvg1mJ8", howToLink: "https://www.youtube.com/watch?v=X98pBvg1mJ8", tip: "Biceps kalƒ±nlƒ±ƒüƒ±" },
          { id: "triceps_pushdown", name: "Triceps Pushdown", goals: ["kas", "sikilasma", "kol"], target: "Triceps", region: "arm", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "YsirG0x9Pf4", howToLink: "https://www.youtube.com/watch?v=YsirG0x9Pf4", tip: "Arka kol izolasyon" },
          { id: "concentration_curl", name: "Concentration Curl", goals: ["sikilasma", "kol"], target: "Biceps", region: "arm", type: "free_weight", sets: 3, reps: "12-15", rest: 60, videoId: "0AUGkch3tzc", howToLink: "https://www.youtube.com/watch?v=0AUGkch3tzc", tip: "Biceps tepe noktasƒ±" },
          { id: "preacher_curl", name: "Preacher Curl Machine", goals: ["kas", "kol"], target: "Biceps", region: "arm", type: "machine", sets: 3, reps: "10-12", rest: 60, videoId: "DoCWeUBA0Gs", howToLink: "https://www.youtube.com/watch?v=DoCWeUBA0Gs", tip: "ƒ∞zole biceps" },
          { id: "overhead_triceps", name: "Overhead Triceps Ext", goals: ["kas", "kol"], target: "Triceps", region: "arm", type: "free_weight", sets: 3, reps: "10-12", rest: 60, videoId: "_gsUck-7M74", howToLink: "https://www.youtube.com/watch?v=_gsUck-7M74", tip: "Triceps uzun ba≈üƒ±" },
          { id: "triceps_kickback", name: "Triceps Kickback", goals: ["sikilasma", "kol"], target: "Triceps", region: "arm", type: "free_weight", sets: 3, reps: "15-20", rest: 45, videoId: "6SS6K3lAwZ8", howToLink: "https://www.youtube.com/watch?v=6SS6K3lAwZ8", tip: "Sƒ±kƒ±la≈ütƒ±rma" },

          // BACAK & KAL√áA
          { id: "squat", name: "Squat", goals: ["kas", "kilo_verme", "sikilasma", "bacak", "guc"], target: "Bacak & Kal√ßa", region: "leg", type: "free_weight", sets: 4, reps: "8-12", rest: 120, videoId: "WZRJW4UpkkE", howToLink: "https://www.youtube.com/watch?v=WZRJW4UpkkE", tip: "Temel alt v√ºcut" },
          { id: "leg_press", name: "Leg Press", goals: ["kas", "bacak"], target: "Quadriceps", region: "leg", type: "machine", sets: 4, reps: "10-12", rest: 90, videoId: "2q7kXFKsIwY", howToLink: "https://www.youtube.com/watch?v=2q7kXFKsIwY", tip: "Bacak hacmi" },
          { id: "leg_curl", name: "Leg Curl", goals: ["sikilasma", "bacak"], target: "Hamstring", region: "leg", type: "machine", sets: 3, reps: "12-15", rest: 60, videoId: "69_4qE2o-9A", howToLink: "https://www.youtube.com/watch?v=69_4qE2o-9A", tip: "Arka bacak izolasyonu" },
          { id: "hip_thrust", name: "Hip Thrust", goals: ["kas", "sikilasma", "bacak"], target: "Kal√ßa", region: "leg", type: "free_weight", sets: 4, reps: "10-15", rest: 90, videoId: "u-lCNOsSGnc", howToLink: "https://www.youtube.com/watch?v=u-lCNOsSGnc", tip: "Kal√ßa i√ßin en etkili" },
          { id: "calf_raise", name: "Standing Calf Raise", goals: ["kas", "bacak"], target: "Baldƒ±r", region: "leg", type: "machine", sets: 4, reps: "15-20", rest: 45, videoId: "n4czfyhJZXM", howToLink: "https://www.youtube.com/watch?v=n4czfyhJZXM", tip: "Baldƒ±r hacmi" },
          { id: "walking_lunge", name: "Walking Lunge", goals: ["sikilasma", "bacak", "kilo_verme"], target: "Bacak & Kal√ßa", region: "leg", type: "free_weight", sets: 3, reps: "12-15", rest: 60, videoId: "wrwwXE_x-pQ", howToLink: "https://www.youtube.com/watch?v=wrwwXE_x-pQ", tip: "Dinamik bacak hareketi" },
          { id: "split_squat", name: "Bulgarian Split Squat", goals: ["kas", "sikilasma", "bacak"], target: "Kal√ßa & Bacak", region: "leg", type: "free_weight", sets: 3, reps: "10-12", rest: 90, videoId: "2C-uNgKwPLE", howToLink: "https://www.youtube.com/watch?v=2C-uNgKwPLE", tip: "Tek bacak kuvveti" },
          { id: "glute_kickback", name: "Glute Kickback Machine", goals: ["sikilasma", "bacak"], target: "Kal√ßa", region: "leg", type: "machine", sets: 3, reps: "15-20", rest: 60, videoId: "SJ1Xuz9D-ZQ", howToLink: "https://www.youtube.com/watch?v=SJ1Xuz9D-ZQ", tip: "Kal√ßa izolasyonu" },
          { id: "sumo_squat", name: "Sumo Squat", goals: ["sikilasma", "bacak"], target: "ƒ∞√ß Bacak & Kal√ßa", region: "leg", type: "free_weight", sets: 3, reps: "12-15", rest: 90, videoId: "GZbfZ033f74", howToLink: "https://www.youtube.com/watch?v=GZbfZ033f74", tip: "ƒ∞√ß bacak odaklƒ±" },

          // KARIN / CORE
          { id: "crunch", name: "Crunch", goals: ["sikilasma", "karin"], target: "Karƒ±n", region: "core", type: "body_weight", sets: 3, reps: "20-25", rest: 45, videoId: "Xyd_fa5zoEU", howToLink: "https://www.youtube.com/watch?v=Xyd_fa5zoEU", tip: "Mide kaslarƒ±nƒ± sƒ±kƒ±≈ütƒ±r" },
          { id: "leg_raise", name: "Leg Raise", goals: ["sikilasma", "karin"], target: "Alt Karƒ±n", region: "core", type: "body_weight", sets: 3, reps: "15-20", rest: 45, videoId: "JB2oyawG9KI", howToLink: "https://www.youtube.com/watch?v=JB2oyawG9KI", tip: "Alt karƒ±n d√ºzle≈ütirme" },
          { id: "plank", name: "Plank", goals: ["sikilasma", "karin", "guc"], target: "Core & Bel", region: "core", type: "body_weight", sets: 3, reps: "45-60sn", rest: 60, videoId: "ASdvN_XEl_c", howToLink: "https://www.youtube.com/watch?v=ASdvN_XEl_c", tip: "Statik dayanƒ±klƒ±lƒ±k" }
        ];


        // APP STATE
        let selectedGoals = [];
        let selectedDays = null;

        // GOAL BUTTONS
        document.querySelectorAll('.goal-btn').forEach(btn => {
          btn.addEventListener('click', function () {
            const goal = this.dataset.goal;
            if (selectedGoals.includes(goal)) {
              selectedGoals = selectedGoals.filter(g => g !== goal);
              this.classList.remove('selected');
            } else {
              selectedGoals.push(goal);
              this.classList.add('selected');
            }
          });
        });

        // DAY BUTTONS
        document.querySelectorAll('.day-btn').forEach(btn => {
          btn.addEventListener('click', function () {
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            selectedDays = parseInt(this.dataset.days);
          });
        });

        // GENERATE PROGRAM
        function generateProgram() {
          // 1. Filter and Score Exercises
          let activeExercises = exercises.map(ex => {
            let score = 0;
            let matchCount = 0;

            // Score by Goal Match
            selectedGoals.forEach(g => {
              if (ex.goals.includes(g)) {
                score += 10;
                matchCount++;
              }
            });

            // Bonus for Compound Movements (Free Weight)
            if (ex.type === 'free_weight') score += 2;

            return { exercise: ex, score: score, matchCount: matchCount };
          }).filter(item => item.matchCount > 0);

          // Fallback if no specific matches (shouldn't happen usually)
          if (activeExercises.length === 0) {
            activeExercises = exercises.map(ex => ({ exercise: ex, score: 1, matchCount: 1 }));
          }

          // 2. Shuffle within Score Tiers (to keep it fresh but relevant)
          activeExercises = shuffleArray(activeExercises).sort((a, b) => b.score - a.score);

          const days = [];
          const exercisesPerDay = 6;
          let availableExercises = activeExercises.map(item => item.exercise);

          // 3. Distribute across days with Region Balance
          for (let d = 0; d < selectedDays; d++) {
            const dayExercises = [];
            const usedRegions = new Set();

            // Try to pick exercises with distinct regions per day if possible (full body feel)
            // OR just fill efficiently
            for (let i = 0; i < exercisesPerDay; i++) {
              // Find next best unused exercise
              const nextIndex = availableExercises.findIndex(ex =>
                !dayExercises.includes(ex) // Simple duplicate check
              );

              if (nextIndex >= 0) {
                dayExercises.push(availableExercises[nextIndex]);
                availableExercises.splice(nextIndex, 1); // Remove used to avoid repeating in same cycle
              } else {
                // Reset available if run out (for high frequency days)
                availableExercises = shuffleArray(exercises.filter(ex => ex.goals.some(g => selectedGoals.includes(g))));
                i--; // Retry slot
              }
            }
            days.push(dayExercises);
          }
          return days;
        }

        function shuffleArray(array) {
          const arr = [...array];
          for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        }

        // SHOW PROGRAM
        function showProgram() {
          const height = document.getElementById('height').value;
          const weight = document.getElementById('weight').value;
          const age = document.getElementById('age').value;

          if (!height || !weight || !age) {
            alert('L√ºtfen boy, kilo ve ya≈üƒ±nƒ± gir');
            return;
          }
          if (selectedGoals.length === 0) {
            alert('L√ºtfen en az bir hedef se√ß');
            return;
          }
          if (!selectedDays) {
            alert('Haftada ka√ß g√ºn spor yapacaƒüƒ±nƒ± se√ß');
            return;
          }

          const program = generateProgram();
          const goalLabels = {
            'kilo_verme': 'Kilo Verme',
            'sikilasma': 'Sƒ±kƒ±la≈üma',
            'kas': 'Kas Yapma',
            'kol': 'Kol',
            'karin': 'Karƒ±n',
            'bacak': 'Bacak'
          };

          const summaryHtml = `
        <span class="summary-badge">${selectedGoals.map(g => goalLabels[g] || g).join(', ')}</span>
        <span class="summary-badge">Haftada ${selectedDays} g√ºn</span>
        `;
          document.getElementById('program-summary').innerHTML = summaryHtml;

          const container = document.getElementById('days-container');
          container.innerHTML = '';

          program.forEach((dayExercises, index) => {
            const dayNum = index + 1;
            const dayHtml = `
        <div class="day-section">
          <div class="day-header ${dayNum === 1 ? 'active' : ''}" onclick="toggleDay(this)">
            <h3>G√ºn ${dayNum}</h3>
            <span class="count">${dayExercises.length} egzersiz</span>
            <span class="arrow">‚ñº</span>
          </div>
          <div class="day-content ${dayNum === 1 ? 'active' : ''}">
            <div class="progress-container" data-day="${dayNum}">
              <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
              </div>
              <div class="progress-text">0% tamamlandƒ±</div>
            </div>
            ${dayExercises.map(ex => renderExerciseCard(ex, dayNum)).join('')}
          </div>
        </div>
        `;
            container.innerHTML += dayHtml;
          });

          // Save user answers for "Today" button
          localStorage.setItem('fitplanUserAnswers', JSON.stringify({
            daysPerWeek: selectedDays,
            goals: selectedGoals
          }));

          loadProgress();
          updateProgressBars();
          showTodayButton();

          document.getElementById('questions-section').style.display = 'none';
          document.getElementById('program-section').style.display = 'block';
          document.getElementById('fixed-bottom').style.display = 'none';
          document.getElementById('welcome-header').style.display = 'none';
          const appBar = document.getElementById('app-bar');
          if (appBar) appBar.style.display = 'flex';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // RENDER EXERCISE CARD
        function renderExerciseCard(exercise, dayNum) {
          const checkboxId = `check_${dayNum}_${exercise.id}`;
          const lastWeight = getLastWeight(dayNum, exercise.id);
          const weightInputId = `weight_${dayNum}_${exercise.id}`;

          const typeLabels = { 'free_weight': 'Serbest Aƒüƒ±rlƒ±k', 'machine': 'Makine', 'body_weight': 'V√ºcut Aƒüƒ±rlƒ±ƒüƒ±' };
          const regionLabels = { 'chest': 'G√∂ƒü√ºs', 'back': 'Sƒ±rt', 'shoulder': 'Omuz', 'arm': 'Kol', 'leg': 'Bacak', 'core': 'Karƒ±n' };

          return `
        <div class="exercise-card" id="card_${dayNum}_${exercise.id}">
          <div class="exercise-header">
            <div>
              <div class="exercise-name">${exercise.name}</div>
              <div class="exercise-target">${exercise.target}</div>
            </div>
            <div class="exercise-sets">${exercise.sets}√ó${exercise.reps}</div>
          </div>

          <div class="exercise-meta">
            <span>${regionLabels[exercise.region] || exercise.region} ‚Ä¢ ${typeLabels[exercise.type] || exercise.type}</span>
            <span>Dinlenme: ${exercise.rest}sn</span>
          </div>

          <div class="weight-input">
            <label>Aƒüƒ±rlƒ±k:</label>
            <input type="number" id="${weightInputId}" placeholder="${lastWeight || '0'}" value="${lastWeight || ''}"
              onchange="saveWeight('${dayNum}', '${exercise.id}', this.value)" step="0.5">
            <span class="unit-label">kg</span>
          </div>

          <div class="video-container" id="video_${dayNum}_${exercise.id}">
            <div class="video-placeholder" onclick="loadVideo('${dayNum}', '${exercise.id}', '${exercise.videoId}')">
              <div class="play-icon">
                <svg viewBox="0 0 24 24">
                  <polygon points="5,3 19,12 5,21" />
                </svg>
              </div>
              <div class="play-text">Videoyu ƒ∞zle</div>
            </div>
          </div>

          <div class="btn-row">
            <a href="${exercise.howToLink}" target="_blank" class="btn-secondary btn-youtube">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
              </svg>
              YouTube'da A√ß
            </a>
          </div>

          <div class="checkbox-row" onclick="toggleCheckbox('${checkboxId}')">
            <input type="checkbox" id="${checkboxId}"
              onclick="event.stopPropagation(); toggleComplete('${dayNum}', '${exercise.id}')">
            <label for="${checkboxId}">Tamamlandƒ±</label>
          </div>

          ${exercise.tip ? `
          <div class="exercise-tip">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
            <span>${exercise.tip}</span>
          </div>
          ` : ''}
        </div>
        `;
        }

        // VIDEO
        function loadVideo(dayNum, exerciseId, videoId) {
          const container = document.getElementById(`video_${dayNum}_${exerciseId}`);
          container.innerHTML = `<iframe
          src="https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1&playsinline=1" title="Video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>`;
        }

        // ACCORDION
        function toggleDay(header) {
          const wasActive = header.classList.contains('active');
          document.querySelectorAll('.day-header').forEach(h => h.classList.remove('active'));
          document.querySelectorAll('.day-content').forEach(c => c.classList.remove('active'));
          if (!wasActive) {
            header.classList.add('active');
            header.nextElementSibling.classList.add('active');
          }
        }

        // CHECKBOX
        function toggleCheckbox(checkboxId) {
          const checkbox = document.getElementById(checkboxId);
          checkbox.checked = !checkbox.checked;
          const parts = checkboxId.split('_');
          const dayNum = parts[1];
          const exerciseId = parts.slice(2).join('_');
          toggleComplete(dayNum, exerciseId);
        }

        function toggleComplete(dayNum, exerciseId) {
          const card = document.getElementById(`card_${dayNum}_${exerciseId}`);
          const checkbox = document.getElementById(`check_${dayNum}_${exerciseId}`);
          card.classList.toggle('completed', checkbox.checked);
          saveProgress();
        }

        function saveProgress() {
          const progress = {};
          document.querySelectorAll('.exercise-card input[type="checkbox"]').forEach(cb => {
            progress[cb.id] = cb.checked;
          });
          localStorage.setItem('fitplanProgress', JSON.stringify(progress));
        }

        function loadProgress() {
          try {
            const saved = localStorage.getItem('fitplanProgress');
            if (saved) {
              const progress = JSON.parse(saved);
              Object.keys(progress).forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox && progress[id]) {
                  checkbox.checked = true;
                  const card = checkbox.closest('.exercise-card');
                  if (card) card.classList.add('completed');
                }
              });
            }
          } catch (e) { }
        }

        function resetApp() {
          if (confirm('Ba≈ütan ba≈ülamak istediƒüine emin misin?')) {
            localStorage.removeItem('fitplanProgress');
            localStorage.removeItem('fitplanWeights');
            localStorage.removeItem('fitplanTimer');
            localStorage.removeItem('fitplanWeekly');
            localStorage.removeItem('fitplanUserAnswers');
            localStorage.removeItem('fitplanHistory'); // Optional: keep history?
            location.reload();
          }
        }

        // ============================================
        // TIMER FUNCTIONALITY
        // ============================================
        let timerInterval = null;
        let timerSeconds = 0;
        let timerRunning = false;

        function startTimer() {
          if (!timerRunning) {
            timerRunning = true;
            const startTime = Date.now() - (timerSeconds * 1000);
            localStorage.setItem('fitplanTimer', JSON.stringify({ startTime, running: true }));

            timerInterval = setInterval(() => {
              timerSeconds = Math.floor((Date.now() - startTime) / 1000);
              updateTimerDisplay();
            }, 100);

            document.getElementById('timer-widget').classList.add('active');
          }
        }

        function stopTimer() {
          if (timerRunning) {
            timerRunning = false;
            clearInterval(timerInterval);
            localStorage.setItem('fitplanTimer', JSON.stringify({ seconds: timerSeconds, running: false }));
          }
        }

        function resetTimer() {
          stopTimer();
          timerSeconds = 0;
          updateTimerDisplay();
          localStorage.removeItem('fitplanTimer');
        }

        function updateTimerDisplay() {
          const mins = Math.floor(timerSeconds / 60);
          const secs = timerSeconds % 60;
          document.getElementById('timer-display').textContent =
            `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function loadTimer() {
          try {
            const saved = localStorage.getItem('fitplanTimer');
            if (saved) {
              const data = JSON.parse(saved);
              if (data.running && data.startTime) {
                timerSeconds = Math.floor((Date.now() - data.startTime) / 1000);
                startTimer();
              } else if (data.seconds) {
                timerSeconds = data.seconds;
                updateTimerDisplay();
                document.getElementById('timer-widget').classList.add('active');
              }
            }
          } catch (e) { }
        }

        // ============================================
        // WEIGHT TRACKING
        // ============================================
        function saveWeight(dayNum, exerciseId, weight) {
          try {
            const weights = JSON.parse(localStorage.getItem('fitplanWeights') || '{}');
            const today = new Date().toISOString().split('T')[0];
            const key = `${dayNum}_${exerciseId}`;

            if (!weights[key]) weights[key] = [];
            weights[key].push({ date: today, weight: parseFloat(weight) });

            // Keep last 30 entries
            if (weights[key].length > 30) weights[key] = weights[key].slice(-30);

            localStorage.setItem('fitplanWeights', JSON.stringify(weights));
          } catch (e) { }
        }

        function getLastWeight(dayNum, exerciseId) {
          try {
            const weights = JSON.parse(localStorage.getItem('fitplanWeights') || '{}');
            const key = `${dayNum}_${exerciseId}`;
            const history = weights[key];
            if (history && history.length > 0) {
              return history[history.length - 1].weight;
            }
          } catch (e) { }
          return null;
        }

        // ============================================
        // HISTORY PERSISTENCE
        // ============================================
        function saveWorkoutHistory(dayNum) {
          try {
            const history = JSON.parse(localStorage.getItem('fitplanHistory') || '{}');
            const today = new Date().toISOString().split('T')[0];

            // Calculate progress for the day
            const progress = calculateDayProgress(dayNum);

            // Get completed exercises
            const prefix = `check_${dayNum}_`;
            const checkboxes = Array.from(document.querySelectorAll(`input[id^="${prefix}"]`));
            const completedExercises = checkboxes
              .filter(cb => cb.checked)
              .map(cb => cb.id.replace(prefix, ''));

            // Save entry
            history[today] = {
              date: today,
              dayNum: dayNum,
              progress: progress,
              completedExercises: completedExercises,
              timestamp: Date.now()
            };

            localStorage.setItem('fitplanHistory', JSON.stringify(history));
          } catch (e) {
            console.error('Error saving history:', e);
          }
        }

        // ============================================
        // PROGRESS CALCULATION
        // ============================================
        function calculateDayProgress(dayNum) {
          const prefix = `check_${dayNum}_`;
          const checkboxes = Array.from(document.querySelectorAll(`input[id^="${prefix}"]`));
          if (checkboxes.length === 0) return 0;
          const completed = checkboxes.filter(cb => cb.checked).length;
          return Math.round((completed / checkboxes.length) * 100);
        }

        function updateProgressBars() {
          document.querySelectorAll('.progress-container').forEach(container => {
            const dayNum = container.dataset.day;
            const progress = calculateDayProgress(dayNum);
            const fill = container.querySelector('.progress-fill');
            const text = container.querySelector('.progress-text');
            if (fill) fill.style.width = `${progress}%`;
            if (text) text.textContent = `${progress}% tamamlandƒ±`;
          });
        }

        // ============================================
        // "TODAY" BUTTON LOGIC
        // ============================================
        function getTodayWorkoutDay() {
          try {
            const userAnswers = JSON.parse(localStorage.getItem('fitplanUserAnswers') || '{}');
            if (!userAnswers.daysPerWeek) return null;

            const daysPerWeek = userAnswers.daysPerWeek;
            const today = new Date().getDay(); // 0=Sun, 1=Mon, ..., 6=Sat

            // Map days based on frequency
            const workoutDays = {
              2: [1, 4], // Mon, Thu
              3: [1, 3, 5], // Mon, Wed, Fri
              4: [1, 2, 4, 5], // Mon, Tue, Thu, Fri
              5: [1, 2, 3, 4, 5] // Mon-Fri
            };

            const scheduledDays = workoutDays[daysPerWeek] || [];
            const dayIndex = scheduledDays.indexOf(today);

            if (dayIndex >= 0) {
              return dayIndex + 1; // Return workout day number (1-indexed)
            }
            return 0; // Rest day
          } catch (e) {
            return null;
          }
        }

        function showTodayButton() {
          const todayDay = getTodayWorkoutDay();
          if (todayDay && todayDay > 0) {
            const button = document.createElement('button');
            button.className = 'today-btn';
            button.innerHTML = `
        Bug√ºnk√º Antrenman: G√ºn ${todayDay}
        <div class="subtitle">Ba≈ülamak i√ßin tƒ±kla</div>
        `;
            button.onclick = () => scrollToDay(todayDay);

            const programHeader = document.querySelector('.program-header');
            if (programHeader) {
              programHeader.insertAdjacentElement('afterend', button);
            }
          } else if (todayDay === 0) {
            const button = document.createElement('button');
            button.className = 'today-btn';
            button.style.background = 'var(--bg-secondary)';
            button.innerHTML = `
        Bug√ºn Dinlenme G√ºn√º
        <div class="subtitle">Yarƒ±n devam edelim!</div>
        `;
            button.disabled = true;

            const programHeader = document.querySelector('.program-header');
            if (programHeader) {
              programHeader.insertAdjacentElement('afterend', button);
            }
          }
        }

        function scrollToDay(dayNum) {
          const headers = document.querySelectorAll('.day-header');
          if (headers[dayNum - 1]) {
            headers[dayNum - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
            setTimeout(() => {
              if (!headers[dayNum - 1].classList.contains('active')) {
                headers[dayNum - 1].click();
              }
            }, 500);
          }
        }

        // ============================================
        // WEEKLY ADAPTATION ENGINE
        // ============================================
        function saveWeeklyCompletion() {
          try {
            const weekStart = getWeekStart();
            const weekly = JSON.parse(localStorage.getItem('fitplanWeekly') || '{}');

            if (!weekly[weekStart]) {
              weekly[weekStart] = { days: {}, totalCompletion: 0 };
            }

            // Calculate completion for each day
            for (let d = 1; d <= selectedDays; d++) {
              weekly[weekStart].days[d] = calculateDayProgress(d);
            }

            // Calculate average completion
            const completionValues = Object.values(weekly[weekStart].days);
            const avgCompletion = completionValues.reduce((a, b) => a + b, 0) / completionValues.length;
            weekly[weekStart].totalCompletion = avgCompletion;

            localStorage.setItem('fitplanWeekly', JSON.stringify(weekly));
          } catch (e) { }
        }

        function getWeekStart() {
          const now = new Date();
          const day = now.getDay();
          const diff = now.getDate() - day + (day === 0 ? -6 : 1); // Monday
          const monday = new Date(now.setDate(diff));
          return monday.toISOString().split('T')[0];
        }

        function getProgressionMultiplier() {
          try {
            const weekly = JSON.parse(localStorage.getItem('fitplanWeekly') || '{}');
            const weeks = Object.keys(weekly).sort().reverse();
            if (weeks.length === 0) return 1.0;

            const lastWeek = weekly[weeks[0]];
            if (!lastWeek) return 1.0;

            const completion = lastWeek.totalCompletion;

            // Progression rules
            if (completion >= 90) return 1.05; // 5% increase
            if (completion >= 70) return 1.0; // Maintain
            return 0.95; // 5% decrease
          } catch (e) {
            return 1.0;
          }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('load', () => {
          loadTimer();

          // Register Service Worker for PWA
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
              .then(registration => console.log('SW registered:', registration.scope))
              .catch(err => console.log('SW registration failed:', err));
          }

          // Check if user has previously created a program
          const savedAnswers = localStorage.getItem('fitplanUserAnswers');
          if (savedAnswers) {
            try {
              const answers = JSON.parse(savedAnswers);
              if (answers.daysPerWeek && answers.goals && answers.goals.length > 0) {
                // Restore state
                selectedDays = answers.daysPerWeek;
                selectedGoals = answers.goals;

                // Regenerate program
                const program = generateProgram();

                // Hide questions, show program
                document.getElementById('questions-section').style.display = 'none';
                document.getElementById('program-section').style.display = 'block';
                document.getElementById('fixed-bottom').style.display = 'none';

                // Rebuild UI
                const goalLabels = {
                  'kilo_verme': 'Kilo Verme',
                  'sikilasma': 'Sƒ±kƒ±la≈üma',
                  'kas': 'Kas Yapma',
                  'kol': 'Kol',
                  'karin': 'Karƒ±n',
                  'bacak': 'Bacak/Kal√ßa',
                  'kondisyon': 'Kondisyon',
                  'esneklik': 'Esneklik',
                  'dayaniklilik': 'Dayanƒ±klƒ±lƒ±k'
                };

                const summaryHtml = `
          <span class="summary-badge">${selectedGoals.map(g => goalLabels[g]).join(', ')}</span>
          <span class="summary-badge">Haftada ${selectedDays} g√ºn</span>
          `;
                document.getElementById('program-summary').innerHTML = summaryHtml;

                const container = document.getElementById('days-container');
                container.innerHTML = '';

                program.forEach((dayExercises, index) => {
                  const dayNum = index + 1;
                  const dayHtml = `
          <div class="day-section">
            <div class="day-header ${dayNum === 1 ? 'active' : ''}" onclick="toggleDay(this)">
              <h3>G√ºn ${dayNum}</h3>
              <span class="count">${dayExercises.length} egzersiz</span>
              <span class="arrow">‚ñº</span>
            </div>
            <div class="day-content ${dayNum === 1 ? 'active' : ''}">
              <div class="progress-container" data-day="${dayNum}">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-text">0% tamamlandƒ±</div>
              </div>
              ${dayExercises.map(ex => renderExerciseCard(ex, dayNum)).join('')}
            </div>
          </div>
          `;
                  container.innerHTML += dayHtml;
                });

                // Restore progress and UI state
                loadProgress();
                updateProgressBars();
                showTodayButton();
              }
            } catch (e) {
              console.error('Error restoring program:', e);
            }
          }
        });

        // Update progress bars whenever checkbox changes
        const originalToggleComplete = toggleComplete;
        toggleComplete = function (dayNum, exerciseId) {
          originalToggleComplete(dayNum, exerciseId);
          updateProgressBars();
          saveWeeklyCompletion();
          saveWorkoutHistory(dayNum);
        };

        // ============================================
        // DRAWER NAVIGATION
        // ============================================
        function openDrawer() {
          document.getElementById('drawer').classList.add('open');
          document.getElementById('drawer-backdrop').classList.add('active');
        }

        function closeDrawer() {
          document.getElementById('drawer').classList.remove('open');
          document.getElementById('drawer-backdrop').classList.remove('active');
        }

        function navigateTo(section) {
          closeDrawer();

          // Update active state
          document.querySelectorAll('.drawer-menu-item').forEach(item => {
            item.classList.remove('active');
          });
          const activeItem = document.querySelector(`.drawer-menu-item[onclick="navigateTo('${section}')"]`);
          if (activeItem) activeItem.classList.add('active');

          // Hide all main sections
          const sections = ['program-section', 'questions-section', 'history-section', 'weights-section', 'projects-section', 'fixed-bottom', 'welcome-header'];
          sections.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
          });

          // Always show app-bar in navigation
          const appBar = document.getElementById('app-bar');
          if (appBar) appBar.style.display = 'flex';

          // Handle navigation based on section
          switch (section) {
            case 'today':
              document.getElementById('program-section').style.display = 'block';
              showTodayButton(); // Will handle fixed bottom button
              window.scrollTo({ top: 0, behavior: 'smooth' });
              break;

            case 'history':
              document.getElementById('history-section').style.display = 'block';
              renderHistoryView();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              break;

            case 'weights':
              document.getElementById('weights-section').style.display = 'block';
              renderWeightHistoryView();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              break;

            case 'stats':
              alert('ƒ∞statistikler yakƒ±nda eklenecek!');
              document.getElementById('program-section').style.display = 'block';
              document.getElementById('fixed-bottom').style.display = 'block';
              break;

            case 'projects':
              document.getElementById('projects-section').style.display = 'block';
              renderProjectsView();
              window.scrollTo({ top: 0, behavior: 'smooth' });
              break;
          }
        }

        // ============================================
        // HISTORY VIEW
        // ============================================
        function renderHistoryView() {
          const container = document.getElementById('history-container');
          const history = JSON.parse(localStorage.getItem('fitplanHistory') || '{}');
          const sortedDates = Object.keys(history).sort().reverse();

          if (sortedDates.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Hen√ºz ge√ßmi≈ü kaydƒ± yok.<br>ƒ∞lk antrenmanƒ±nƒ± tamamla!</p>';
            return;
          }

          let html = '';
          let currentWeek = '';

          sortedDates.forEach(date => {
            const entry = history[date];
            const entryDate = new Date(date);

            // Calculate week start for grouping
            const day = entryDate.getDay();
            const diff = entryDate.getDate() - day + (day === 0 ? -6 : 1);
            const weekStart = new Date(entryDate.setDate(diff)).toISOString().split('T')[0];

            if (weekStart !== currentWeek) {
              if (currentWeek !== '') html += '</div>'; // Close previous group
              currentWeek = weekStart;
              const weekLabel = new Date(weekStart).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' });
              html += `
            <div class="history-week-group">
              <div class="history-week-label">Hafta Ba≈ülangƒ±cƒ±: ${weekLabel}</div>
          `;
            }

            const dateLabel = new Date(date).toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' });

            html += `
          <div class="history-item">
            <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
              <span style="font-weight:600; font-size:15px; color:var(--text-primary);">G√ºn ${entry.dayNum}</span>
              <span style="color:var(--text-secondary); font-size:13px;">${dateLabel}</span>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <span style="font-size:13px; color:var(--text-secondary);">${entry.completedExercises.length} egzersiz tamamlandƒ±</span>
              <span style="font-weight:600; color:var(--accent); font-size:14px;">%${entry.progress}</span>
            </div>
          </div>
        `;
          });

          if (currentWeek !== '') html += '</div>'; // Close last group
          container.innerHTML = html;
        }

        // ============================================
        // WEIGHT HISTORY VIEW
        // ============================================
        function renderWeightHistoryView() {
          const container = document.getElementById('weights-container');
          const weights = JSON.parse(localStorage.getItem('fitplanWeights') || '{}');
          const keys = Object.keys(weights);

          if (keys.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Hen√ºz aƒüƒ±rlƒ±k kaydƒ± yok.<br>Egzersiz kartlarƒ±na aƒüƒ±rlƒ±k girin.</p>';
            return;
          }

          let html = '';

          keys.forEach(key => {
            const [dayNum, exerciseId] = key.split('_');
            const history = weights[key].sort((a, b) => new Date(b.date) - new Date(a.date));

            // Find exercise details
            const exercise = exercises.find(e => e.id === exerciseId);
            const name = exercise ? exercise.name : exerciseId;

            // Calculate trend
            let trendHtml = '';
            if (history.length >= 2) {
              const current = history[0].weight;
              const prev = history[1].weight;
              if (current > prev) trendHtml = `<span class="trend-up">üìà +${(current - prev).toFixed(1)}kg</span>`;
              else if (current < prev) trendHtml = `<span class="trend-down">üìâ ${(current - prev).toFixed(1)}kg</span>`;
            }

            html += `
          <div class="weight-item">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <span style="font-weight:700; font-size:15px; color:var(--text-primary);">${name}</span>
              ${trendHtml}
            </div>
            <div class="weight-history-list">
        `;

            // Show last 5 entries
            history.slice(0, 5).forEach(entry => {
              const dateLabel = new Date(entry.date).toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' });
              html += `
            <div class="weight-entry">
              <span>${dateLabel}</span>
              <span style="font-weight:600; color:var(--text-primary);">${entry.weight} kg</span>
            </div>
          `;
            });

            html += `
            </div>
          </div>
        `;
          });

          container.innerHTML = html;
        }

        // ============================================
        // PROJECTS LOGIC
        // ============================================
        function renderProjectsView() {
          const container = document.getElementById('projects-container');
          const projects = JSON.parse(localStorage.getItem('fitplanProjects') || '[]');
          const activeProjectId = localStorage.getItem('fitplanActiveProjectId'); // null = default

          if (projects.length === 0) {
            container.innerHTML = `
          <div style="text-align:center; padding:40px; color:var(--text-secondary)">
            <p>Hen√ºz kayƒ±tlƒ± proje yok.</p>
            <p style="font-size:13px; margin-top:8px;">Mevcut programƒ±nƒ± kaydetmek i√ßin + butonuna bas.</p>
          </div>
        `;
            return;
          }

          let html = '';

          projects.forEach(proj => {
            const isActive = activeProjectId === proj.id;
            const activeClass = isActive ? 'active-project' : '';
            const badge = isActive ? '<span class="project-active-badge">AKTƒ∞F</span>' : '';

            html += `
          <div class="project-card ${activeClass}" onclick="activateProject('${proj.id}')">
            <div class="project-header">
              <span class="project-name">${proj.name}</span>
              ${badge}
            </div>
            <div class="project-meta">
              <span>${proj.days} G√ºn/Hafta</span>
              <span>‚Ä¢</span>
              <span>${proj.goals.length} Hedef</span>
            </div>
            <div style="font-size:12px; color:var(--text-muted); margin-top:8px;">
              ${proj.note || ''}
            </div>
          </div>
        `;
          });

          container.innerHTML = html;
        }

        function openProjectModal() {
          document.getElementById('project-modal').classList.add('active');
        }

        function closeProjectModal() {
          document.getElementById('project-modal').classList.remove('active');
        }

        function saveProject() {
          const name = document.getElementById('project-name').value;
          const note = document.getElementById('project-note').value;

          if (!name) { alert('Proje adƒ± giriniz'); return; }

          // Get current settings
          const currentAnswers = JSON.parse(localStorage.getItem('fitplanUserAnswers') || '{}');
          if (!currentAnswers.goals) { alert('√ñnce bir program olu≈üturmalƒ±sƒ±n'); return; }

          const newProject = {
            id: 'proj_' + Date.now(),
            name: name,
            note: note,
            goals: currentAnswers.goals,
            days: currentAnswers.daysPerWeek,
            createdAt: new Date().toISOString()
          };

          const projects = JSON.parse(localStorage.getItem('fitplanProjects') || '[]');
          projects.push(newProject);
          localStorage.setItem('fitplanProjects', JSON.stringify(projects));

          closeProjectModal();
          renderProjectsView();
          // Auto activate
          activateProject(newProject.id);
        }

        function activateProject(id) {
          const projects = JSON.parse(localStorage.getItem('fitplanProjects') || '[]');
          const target = projects.find(p => p.id === id);

          if (!target) return;

          // Update Active ID
          localStorage.setItem('fitplanActiveProjectId', id);

          // Overwrite current program settings
          const newSettings = {
            goals: target.goals,
            daysPerWeek: target.days
          };
          localStorage.setItem('fitplanUserAnswers', JSON.stringify(newSettings));

          // Update Global State
          selectedGoals = target.goals;
          selectedDays = target.days;

          // Refresh UI
          renderProjectsView();

          // Provide Feedback
          alert(`"${target.name}" projesi y√ºklendi! Programƒ±n g√ºncellendi.`);

          // Optionally go to today
          navigateTo('today');

          // Need to re-run showProgram to regenerate the view based on new settings
          showProgram();
        }

        // Touch gesture support for drawer
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
          touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        });

        function handleSwipe() {
          const swipeThreshold = 50;
          const swipeDistance = touchEndX - touchStartX;

          // Swipe right from left edge to open
          if (touchStartX < 30 && swipeDistance > swipeThreshold) {
            openDrawer();
          }

          // Swipe left to close
          const drawer = document.getElementById('drawer');
          if (drawer.classList.contains('open') && swipeDistance < -swipeThreshold) { closeDrawer(); }
        } </script>
</body>

</html>